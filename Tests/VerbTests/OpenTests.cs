using Adventure.Net;
using Adventure.Net.ActionRoutines;
using Adventure.Net.Extensions;
using ColossalCave.Things;
using Xunit;

namespace Tests.VerbTests;

public class OpenTests : BaseTestFixture
{
    [Fact]
    public void cant_open_things_unopenable()
    {
        Execute("open bottle");
        Assert.Contains("That's not something you can open.", ConsoleOut);
    }

    [Fact]
    public void cant_open_if_locked()
    {
        var box = Objects.Get<OpaqueBox>();
        box.MoveToLocation();
        box.Lockable = true;
        box.Locked = true;
        Execute("open box");
        Assert.Contains($"{box.DName.Capitalize()} seems to be locked.", ConsoleOut);
    }

    [Fact]
    public void its_already_open_dude()
    {
        var box = Objects.Get<OpaqueBox>();
        box.MoveToLocation();
        box.Open = true;

        Execute("open box");
        Assert.Contains("That's already open", ConsoleOut);
    }

    [Fact]
    public void should_reveal_the_contents()
    {
        var box = Objects.Get<OpaqueBox>();
        box.MoveToLocation();
        box.Add<SetOfKeys>();
        box.Add<TastyFood>();
        box.Add<Bottle>();
        box.Open = false;

        Execute("open box");

        Assert.Contains($"You open {box.DName}, revealing {box.Children.DisplayList(false)}.", ConsoleOut);
    }

    [Fact]
    public void should_open()
    {
        var box = Objects.Get<OpaqueBox>();
        box.MoveToLocation();
        box.Open = false;

        Execute("open box");

        Assert.Contains($"You open {box.DName}.", ConsoleOut);
    }
}
